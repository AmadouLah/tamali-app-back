spring.application.name=tamaliback
spring.config.import=optional:classpath:application-local.properties

server.port=${PORT:9999}
server.address=0.0.0.0

# Configuration de la base de données
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/tamali}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=${SHOW_SQL:true}
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.fetch_size=25

# PostgreSQL: Configuration du dialecte et désactivation du cache
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.jdbc.use_get_generated_keys=true
spring.jpa.properties.hibernate.boot.allow_jdbc_metadata_access=false

# Hikari Connection Pool (optimized for low memory)
spring.datasource.hikari.maximum-pool-size=3
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=600000
spring.datasource.hikari.leak-detection-threshold=60000

# PostgreSQL: Désactiver le cache des prepared statements
spring.datasource.hikari.data-source-properties.prepareThreshold=0
spring.datasource.hikari.data-source-properties.preparedStatementCacheQueries=0
spring.datasource.hikari.data-source-properties.preparedStatementCacheSizeMiB=0

# Enable scheduling for token cleanup
spring.task.scheduling.pool.size=1

# Upload configuration
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=60MB
storage.root=uploads

# ===== CONFIGURATION JWT =====
app.jwt.secret=${JWT_SECRET:404E635266556A586E3272357538782F413F4428472B4B6250645367566B5970337336763979244226452948404D635166546A576E5A7234753778214125442A}
app.jwt.expiration=${JWT_EXPIRATION:86400000}
app.jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:604800000}

# ===== CONFIGURATION CORS =====
app.cors.allowed-origins=${APP_CORS_ALLOWED_ORIGINS:http://localhost:4200,http://localhost:3000}

# ===== CONFIGURATION SECURITY =====
security.max-login-attempts=5
security.account-lockout-duration=30

# ===== CONFIGURATION SUPABASE STORAGE =====
app.storage.supabase.url=${SUPABASE_URL:https://https://hizqylwmjconaqfvbqbt.supabase.co}
app.storage.supabase.bucket=${SUPABASE_BUCKET:receipt}
app.storage.supabase.service-role-key=${SUPABASE_SERVICE_ROLE_KEY:}
app.storage.supabase.key=${SUPABASE_KEY:}

# ===== CONFIGURATION EMAIL =====
app.mail.provider=${APP_MAIL_PROVIDER:logonly}
app.mail.from=${APP_MAIL_FROM:amadoulandoure004@gmail.com}
app.mail.brevo.api-key=${BREVO_API_KEY:}

# Admin emails (comma-separated)
app.admin.emails=${APP_ADMIN_EMAILS:}

# ===== CONFIGURATION OAUTH2 GOOGLE =====
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID:}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET:}
spring.security.oauth2.client.registration.google.scope=email,profile
spring.security.oauth2.client.registration.google.redirect-uri=${APP_BASE_URL:http://localhost:9999}/api/auth/oauth2/callback/google
spring.security.oauth2.client.provider.google.authorization-uri=https://accounts.google.com/o/oauth2/v2/auth
spring.security.oauth2.client.provider.google.token-uri=https://oauth2.googleapis.com/token
spring.security.oauth2.client.provider.google.user-info-uri=https://www.googleapis.com/oauth2/v3/userinfo
spring.security.oauth2.client.provider.google.user-name-attribute=sub

# ===== CONFIGURATION URLs =====
app.base-url=${APP_BASE_URL:http://localhost:9999}
app.frontend-url=${APP_FRONTEND_URL:https://tamali.vercel.app/}

# ===== CONFIGURATION SPRINGDOC/SWAGGER =====
springdoc.api-docs.path=/v3/api-docs
springdoc.api-docs.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true

# Jackson Configuration
# write-dates-as-timestamps supprimé : non supporté par Jackson 3 (Spring Boot 4)
# Par défaut, Jackson 3 sérialise les dates en ISO-8601
